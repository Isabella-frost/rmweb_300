sap.ui.define(["./BaseController","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,o,r,i,s){"use strict";return e.extend("rm.webshop.shop.controller.xdocprofil",{_oInitialUserData:{},onInit:function(){var e=sap.ui.require.toUrl("rm/webshop/shop")+"/img/Logo.jpg";var t=new o({rmLogo:e,selectedTabKey:"HeadXProfil",UserInfo:{doctor:"",ydernr:"",cvrnr:"",brugernr:"",street:"",zip:"",city:"",phone:"",mail:"",favorite:""}});this.getView().setModel(t,"view");this.getView().setModel(new o({lists:[]}),"webshop");this._fetchUserData();this._fetchFavoriteLists();this.getOwnerComponent().getRouter().getRoute("Routexdocprofil").attachPatternMatched(this._onRouteMatched,this)},_getCurrentUserNo:function(){const e=this.getOwnerComponent().getModel("globalUser");return e?e.getProperty("/UserNo"):null},_fetchUserData:function(){const e=this._getCurrentUserNo();var o=this.getOwnerComponent().getModel();var r=this.getView().getModel("view");const i=`/UserSet('${e}')`;if(!o){t.show("Error: OData model not available.");return}o.read(i,{urlParameters:{$format:"json"},success:function(e){this._oInitialUserData=e;r.setProperty("/UserInfo",{doctor:e.AdrName||"N/A",ydernr:e.Ydernr||"N/A",cvrnr:e.Cvr||"N/A",brugernr:e.UserNo||"N/A",street:e.AdrStreet||"N/A",zip:e.AdrZip||"N/A",city:e.AdrCity||"N/A",phone:e.Phone||"Udfyld her",mail:e.EMail||"Udfyld her",favorite:e.FavoriteList})}.bind(this),error:function(e){t.show("Failed to load user data.");console.error("OData Read failed:",e)}.bind(this)})},_fetchFavoriteLists:function(){var e=this.getOwnerComponent().getModel();var o=this.getView().getModel("webshop");const r=this._getCurrentUserNo();if(!e){return}const a=[new i("UserNo",s.EQ,r)];e.read("/FavoriteSet",{filters:a,urlParameters:{$format:"json"},success:function(e){if(e.results){o.setProperty("/lists",e.results)}else{t.show("No favorite lists found.");o.setProperty("/lists",[])}},error:function(e){t.show("Failed to load favorite lists.");console.error("OData Read FavoriteSet failed:",e)}})},_onRouteMatched:function(e){var t=this.byId("idTopLevelTab");if(t){t.setSelectedKey("HeadXProfil")}},handleIconTabBarSelect:function(e){var t=e.getParameter("selectedKey");var o=this.getOwnerComponent().getRouter();this.getView().getModel("view").setProperty("/selectedTabKey",t);if(t==="HeadXProfil"){return}if(t==="HeadXSoegning"){o.navTo("Routexdocvaresog")}else if(t==="HeadInfo"){o.navTo("Routeinfo")}else if(t==="HeadXOversigt"){o.navTo("Routexdocbestilling")}else if(t==="HeadXSupport"){o.navTo("Routexdocsupport")}},onUpdateContactInfo:function(){var e=this.getView().getModel("view");var t=e.getProperty("/UserInfo");var o={Phone:t.phone,EMail:t.mail};this._updateUser(o,"Kontaktoplysninger")},onUpdateFavoriteList:function(){var e=this.getView().getModel("view");var t=e.getProperty("/UserInfo/favorite");var o={FavoriteList:t};this._updateUser(o,"Favoritliste")},_updateUser:function(e,o){var r=this.getOwnerComponent().getModel();var i=this._oInitialUserData;const s=this._getCurrentUserNo();if(!r){t.show("Fejl: OData model ikke tilg√¶ngelig.");return}var a={UserNo:s,DelName:i.DelName,Phone:i.Phone,EMail:i.EMail,FavoriteList:i.FavoriteList,...e};r.create("/UserSet",a,{success:function(r,i){t.show(o+" opdateret succesfuldt!");if(e.Phone){this.getView().getModel("view").setProperty("/UserInfo/phone",e.Phone)}}.bind(this),error:function(e){t.show("Fejl ved opdatering af "+o.toLowerCase()+".");console.error("OData Create (Update) failed:",e)}})},onBack:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("Routemain")}})});
//# sourceMappingURL=xdocprofil.controller.js.map
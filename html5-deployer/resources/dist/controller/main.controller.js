sap.ui.define(["./BaseController","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel"],(e,t,r,n)=>{"use strict";return e.extend("rm.webshop.shop.controller.main",{onInit(){},async _hashCprWithKey(e){const t="TESTks75ka;.kiaqq-po/gf&.hsqTEST";const r=new TextEncoder;const n=r.encode(e);const o=r.encode(t);const s=await crypto.subtle.importKey("raw",o,{name:"HMAC",hash:"SHA-512"},false,["sign"]);const a=await crypto.subtle.sign("HMAC",s,n);const i=Array.from(new Uint8Array(a));const l=i.map(e=>e.toString(16).padStart(2,"0")).join("").toUpperCase();return l},async onPressLogin(){const e=this.byId("iduserIdInput").getValue().trim();if(!e){t.show("Indtast venligst et CPR-nummer.");return}let o;try{o=await this._hashCprWithKey(e)}catch(e){console.error("Hashing error:",e);r.error("Fejl ved kryptering af CPR-nummer.");return}const s=this.getOwnerComponent().getModel();const a=this;const i=[new sap.ui.model.Filter("CprHash",sap.ui.model.FilterOperator.EQ,o)];s.read("/UserSet",{filters:i,success(e){const r=e.results;if(r.length===0){t.show("Ingen brugere fundet for dette CPR-nummer.");return}const o=new n({users:r});a.getOwnerComponent().setModel(o,"loginUsers");const s=sap.ui.core.UIComponent.getRouterFor(a);a.getOwnerComponent().setModel(o,"loginUsers");a.getOwnerComponent().setModel(new n({role:"patient"}),"loginContext");s.navTo("Routevaelgklinik")},error(e){console.error("OData read error:",e);r.error("Kunne ikke hente brugerdata. Prøv igen.")}})},onPressDoc(){const e=this.byId("idpasswordInput").getValue().trim();if(!e){t.show("Indtast venligst et CVR-nummer.");return}const o=this.getOwnerComponent().getModel();const s=this;const a=[new sap.ui.model.Filter("Cvr",sap.ui.model.FilterOperator.EQ,e)];o.read("/UserSet",{filters:a,success(e){const r=e.results;if(r.length===0){t.show("Ingen brugere fundet for dette CVR-nummer.");return}const o=new n({users:r});s.getOwnerComponent().setModel(o,"loginUsers");const a=sap.ui.core.UIComponent.getRouterFor(s);s.getOwnerComponent().setModel(o,"loginUsers");s.getOwnerComponent().setModel(new n({role:"doc"}),"loginContext");a.navTo("Routevaelgklinik")},error(e){console.error("OData read error:",e);r.error("Kunne ikke hente brugerdata. Prøv igen.")}})}})});
//# sourceMappingURL=main.controller.js.map
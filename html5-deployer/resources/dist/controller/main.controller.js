sap.ui.define(["./BaseController","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator"],(e,r,t,o,s,n)=>{"use strict";return e.extend("rm.webshop.test.controller.main",{onInit(){},_parseODataError(e){let r="Der opstod en fejl. PrÃ¸v igen.";try{if(e&&e.responseText){const t=JSON.parse(e.responseText);if(t.error?.message?.value){r=t.error.message.value}else if(t.error?.innererror?.errordetails?.length>0){r=t.error.innererror.errordetails[0].message||r}}else if(e&&e.message){r=e.message}}catch(e){console.error("Fejl ved parsing af OData fejl:",e)}return r},async _hashCprWithKey(e){const r="TESTks75ka;.kiaqq-po/gf&.hsqTEST";const t=new TextEncoder;const o=t.encode(e);const s=t.encode(r);const n=await crypto.subtle.importKey("raw",s,{name:"HMAC",hash:"SHA-512"},false,["sign"]);const a=await crypto.subtle.sign("HMAC",n,o);const i=Array.from(new Uint8Array(a));return i.map(e=>e.toString(16).padStart(2,"0")).join("").toUpperCase()},async onPressLogin(){const e=this.byId("iduserIdInput").getValue().trim();if(!e){r.show("Indtast venligst et CPR-nummer.");return}let a;try{a=await this._hashCprWithKey(e)}catch(e){console.error("Hashing error:",e);t.error("Fejl ved kryptering af CPR-nummer.");return}const i=this.getOwnerComponent().getModel();const l=this;const c=[new s("CprHash",n.EQ,a)];i.read("/UserSet",{filters:c,success(e){const t=e.results;if(t.length===0){r.show("Ingen brugere fundet for dette CPR-nummer.");return}const s=new o({users:t});l.getOwnerComponent().setModel(s,"loginUsers");const n=new o({role:"patient"});l.getOwnerComponent().setModel(n,"loginContext");const a=sap.ui.core.UIComponent.getRouterFor(l);if(t.length===1){const e=t[0];const r=l.getOwnerComponent().getModel("globalUser");if(r){r.setProperty("/UserNo",e.UserNo);r.setProperty("/User",e);try{window.localStorage.setItem("rm.webshop.globalUser",JSON.stringify(r.getData()))}catch(e){}}a.navTo("Routevaresog")}else{a.navTo("Routevaelgklinik")}},error(e){console.error("OData read error:",e);const r=l._parseODataError(e);t.error(r)}})},onPressDoc(){const e=this.byId("idpasswordInput").getValue().trim();if(!e){r.show("Indtast venligst et CVR-nummer.");return}const a=this.getOwnerComponent().getModel();const i=this;const l=[new s("Cvr",n.EQ,e)];a.read("/UserSet",{filters:l,success(e){const t=e.results;if(t.length===0){r.show("Ingen brugere fundet for dette CVR-nummer.");return}const s=new o({users:t});i.getOwnerComponent().setModel(s,"loginUsers");const n=new o({role:"doc"});i.getOwnerComponent().setModel(n,"loginContext");const a=sap.ui.core.UIComponent.getRouterFor(i);if(t.length===1){const e=t[0];const r=i.getOwnerComponent().getModel("globalUser");if(r){r.setProperty("/UserNo",e.UserNo);r.setProperty("/User",e);try{window.localStorage.setItem("rm.webshop.globalUser",JSON.stringify(r.getData()))}catch(e){}}a.navTo("Routeinfo")}else{a.navTo("Routexdocvaelgklinik")}},error(e){console.error("OData read error:",e);const r=i._parseODataError(e);t.error(r)}})}})});
//# sourceMappingURL=main.controller.js.map
sap.ui.define(["./BaseController","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,o,t,r,n,s){"use strict";return e.extend("rm.webshop.test.controller.info",{onInit:function(){var e=sap.ui.require.toUrl("rm/webshop/test")+"/img/Logo.jpg";var o=new t({rmLogo:e,selectedTabKey:"HeadInfo",UserInfo:{doctor:"",ydernr:"",cvrnr:"",brugernr:""},deliveryInfoHTML:""});this.getView().setModel(o,"view");this._checkBasketOnLogin();this.getOwnerComponent().getRouter().getRoute("Routeinfo").attachPatternMatched(this._onRouteMatched,this)},_onRouteMatched:function(){var e=this.byId("idTopLevelTab");var o=this.getView().getModel("view");o.setProperty("/selectedTabKey","HeadInfo");if(e){e.setSelectedKey("HeadInfo")}this._fetchUserData()},_checkBasketOnLogin:function(){var e=this.getOwnerComponent().getModel();var o=this.getView().getModel("view");var t=this.getOwnerComponent().getModel("globalUser");var r=t?t.getProperty("/UserNo"):null;if(!r){console.warn("No user number found for login basket check.");return}var n=[new sap.ui.model.Filter("UserNo",sap.ui.model.FilterOperator.EQ,r)];e.read("/BasketSet",{filters:n,success:function(e){var t=e.results||[];o.setProperty("/shoppingcart",t);if(t.length>0){var r=t.length;sap.m.MessageBox.information("Vær opmærksom på, at du har "+r+" vare(r) i din kurv fra tidligere.",{title:"Kurv fundet",actions:[sap.m.MessageBox.Action.OK]})}else{console.log("Kurven er tom ved login ingen besked vist.")}},error:function(e){console.error("Fejl ved læsning af kurv:",e);sap.m.MessageToast.show("Kunne ikke hente kurv ved login.")}})},_fetchUserData:function(){var e=this.getOwnerComponent().getModel();var t=this.getView().getModel("view");var r=this.getOwnerComponent().getModel("globalUser");var n=r?r.getProperty("/UserNo"):null;if(!n){o.show("Bruger-ID ikke fundet. Log venligst ind igen.");return}var s=`/UserSet('${n}')`;e.read(s,{urlParameters:{$format:"json"},success:function(e){t.setProperty("/UserInfo",{doctor:e.AdrName||"N/A",ydernr:e.Ydernr||"N/A",cvrnr:e.Cvr||"N/A",brugernr:e.UserNo||"N/A"});t.setProperty("/deliveryInfoHTML",e.UserInfo||"")},error:function(e){console.error("OData Read failed:",e);o.show("Kunne ikke hente brugerdata.");t.setProperty("/UserInfo",{doctor:"Fejl ved indlæsning",ydernr:"",cvrnr:"",brugernr:""})}})},handleIconTabBarSelect:function(e){var o=e.getParameter("selectedKey");var t=this.getView().getModel("view");t.setProperty("/selectedTabKey",o);var r=this.getOwnerComponent().getRouter();switch(o){case"HeadXSoegning":r.navTo("Routexdocvaresog");break;case"HeadInfo":r.navTo("Routeinfo");break;case"HeadXOversigt":r.navTo("Routexdocbestilling");break;case"HeadXProfil":r.navTo("Routexdocprofil");break;case"HeadXSupport":r.navTo("Routexdocsupport");break;default:break}},onBack:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);var o=this.getView().getModel("view");var t=this.getOwnerComponent().getModel("globalUser");var r=t?t.getProperty("/UserNo"):null;var n=this.getOwnerComponent().getModel();var s=[new sap.ui.model.Filter("UserNo",sap.ui.model.FilterOperator.EQ,r)];n.read("/BasketSet",{filters:s,success:function(o){var t=o.results||[];if(t.length>0){sap.m.MessageBox.confirm("Du har varer i din kurv. Vil du fortsat logge af? (Din kurv gemmes til næste besøg)",{title:"Bekræft log af",actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(o){if(o===sap.m.MessageBox.Action.OK){e.navTo("Routemain")}}})}else{e.navTo("Routemain")}},error:function(o){sap.m.MessageBox.warning("Kunne ikke hente din kurv. Vil du fortsætte med at logge af?",{actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(o){if(o===sap.m.MessageBox.Action.OK){e.navTo("Routemain")}}});console.error("BasketSet read error during logoff:",o)}})},onOpenBasket:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("Routexdocvaresog")}})});
//# sourceMappingURL=info.controller.js.map
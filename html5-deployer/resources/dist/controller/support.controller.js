sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/m/MessageToast"],function(e,t,o){"use strict";return e.extend("rm.webshop.test.controller.support",{onInit:function(){var e=sap.ui.require.toUrl("rm/webshop/test")+"/img/Logo.jpg";var o=new t({rmLogo:e,selectedTabKey:"HeadSupport",UserInfo:{navn:"",adresse:"",zip:"",by:"",tlfnr:"",brugernr:"",afdeling:""}});this.getView().setModel(o,"view");this.getOwnerComponent().getRouter().getRoute("Routesupport").attachPatternMatched(this._onRouteMatched,this);this._fetchUserData()},_getCurrentUserNo:function(){const e=this.getOwnerComponent().getModel("globalUser");return e?e.getProperty("/UserNo"):null},_fetchUserData:function(){var e=this.getOwnerComponent().getModel();var t=this.getView().getModel("view");const r=this._getCurrentUserNo();const n=`/UserSet('${r}')`;if(!e){o.show("Error: OData model not available.");return}e.read(n,{urlParameters:{$format:"json"},success:function(e){t.setProperty("/UserInfo",{navn:e.AdrName||"N/A",adresse:e.AdrStreet||"N/A",zip:e.AdrZip||"N/A",by:e.AdrCity||"N/A",tlfnr:e.Phone||"Ukendt, kan opdateres i 'Profil'",brugernr:e.UserNo||"N/A",afdeling:e.Afdeling})}.bind(this),error:function(e){o.show("Failed to load user data.");console.error("OData Read failed:",e);t.setProperty("/UserInfo",{navn:"Fejl: Kunne ikke hente data",adresse:"",zip:"",by:"",tlfnr:"",brugernr:"",afdeling:""})}.bind(this)})},_onRouteMatched:function(e){var t=this.byId("idTopLevelTab");var o=this.getView().getModel("view");if(t){t.setSelectedKey("HeadSupport");o.setProperty("/selectedTabKey","HeadSupport")}},handleIconTabBarSelect:function(e){var t=e.getParameter("selectedKey");var o=this.getView().getModel("view");o.setProperty("/selectedTabKey",t);if(t==="HeadSoegning"){this.getOwnerComponent().getRouter().navTo("Routevaresog")}if(t==="HeadOversigt"){this.getOwnerComponent().getRouter().navTo("Routebestilling")}if(t==="HeadProfil"){this.getOwnerComponent().getRouter().navTo("Routeprofil")}if(t==="HeadSupport"){this.getOwnerComponent().getRouter().navTo("Routesupport")}},onBack:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);var t=this.getView().getModel("view");var o=this._getCurrentUserNo();var r=this.getOwnerComponent().getModel();var n=[new sap.ui.model.Filter("UserNo",sap.ui.model.FilterOperator.EQ,o)];r.read("/BasketSet",{filters:n,success:function(t){var o=t.results||[];if(o.length>0){sap.m.MessageBox.confirm("Du har varer i din kurv. Vil du fortsat logge af? (Din kurv gemmes til næste besøg)",{title:"Bekræft log af",actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(t){if(t===sap.m.MessageBox.Action.OK){e.navTo("Routemain")}}})}else{e.navTo("Routemain")}},error:function(t){sap.m.MessageBox.warning("Kunne ikke hente din kurv. Vil du fortsætte med at logge af?",{actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(t){if(t===sap.m.MessageBox.Action.OK){e.navTo("Routemain")}}});console.error("BasketSet read error during logoff:",t)}})},onOpenBasket:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("Routevaresog")}})});
//# sourceMappingURL=support.controller.js.map
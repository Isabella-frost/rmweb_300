sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/m/MessageToast"],function(e,t,r){"use strict";return e.extend("rm.webshop.shop.controller.profil",{_oInitialUserData:{},onInit:function(){var e=sap.ui.require.toUrl("rm/webshop/shop")+"/img/Logo.jpg";var r=new t({rmLogo:e,selectedAddressOption:0,UserInfo:{navn:"",brugernr:"",street:"",zip:"",city:"",tlfnr:"",phone:"",mail:"",DelStreet:"",DelZip:"",DelCity:"",afdeling:""}});this.getView().setModel(r,"view");this.getOwnerComponent().getRouter().getRoute("Routeprofil").attachPatternMatched(this._onRouteMatched,this);this._fetchUserData()},_getCurrentUserNo:function(){const e=this.getOwnerComponent().getModel("globalUser");return e?e.getProperty("/UserNo"):null},_fetchUserData:function(){var e=this.getOwnerComponent().getModel();var t=this.getView().getModel("view");const o=this._getCurrentUserNo();const n=`/UserSet('${o}')`;if(!e){r.show("Error: OData model not available.");return}e.read(n,{urlParameters:{$format:"json"},success:function(e){this._oInitialUserData=e;t.setProperty("/UserInfo",{navn:e.AdrName||"N/A",brugernr:e.UserNo||"N/A",street:e.AdrStreet||"N/A",zip:e.AdrZip||"N/A",city:e.AdrCity||"N/A",tlfnr:e.Phone||"Ukendt, kan opdateres i 'Profil'",phone:e.Phone||"",mail:e.EMail||"",DelStreet:e.DelStreet||"",DelZip:e.DelZip||"",DelCity:e.DelCity||"",afdeling:e.Afdeling})}.bind(this),error:function(e){r.show("Failed to load user data.");console.error("OData Read failed:",e);t.setProperty("/UserInfo",{navn:"Fejl: Kunne ikke hente data",street:"",zip:"",city:"",tlfnr:"",brugernr:"",afdeling:""})}.bind(this)})},_onRouteMatched:function(e){var t=this.byId("idTopLevelTab");if(t){t.setSelectedKey("HeadProfil")}},handleIconTabBarSelect:function(e){var t=e.getParameter("selectedKey");if(t==="HeadSoegning"){this.getOwnerComponent().getRouter().navTo("Routevaresog")}if(t==="HeadOversigt"){this.getOwnerComponent().getRouter().navTo("Routebestilling")}if(t==="HeadProfil"){this.getOwnerComponent().getRouter().navTo("Routeprofil")}if(t==="HeadSupport"){this.getOwnerComponent().getRouter().navTo("Routesupport")}},onUpdateUser:function(){var e=this.getOwnerComponent().getModel();var t=this.getView().getModel("view");var o=t.getProperty("/UserInfo");var n=this._oInitialUserData;const i=this._getCurrentUserNo();if(!e){r.show("Fejl: OData model ikke tilgængelig.");return}var a={UserNo:i,DelName:n.DelName||"DEL Lægerne Gasvej 5",DelName2:n.DelName2||"Del name2",DelAtt:n.DelAtt||"DEL ATT",FavoriteList:n.FavoriteList||"Favorite99",DelStreet:o.DelStreet,DelZip:o.DelZip,DelCity:o.DelCity,Phone:o.phone,EMail:o.mail};e.create("/UserSet",a,{success:function(e,n){r.show("Brugerinformation opdateret succesfuldt!");t.setProperty("/UserInfo/tlfnr",o.phone);this._fetchUserData()}.bind(this),error:function(e){r.show("Fejl ved opdatering af brugerinformation.");console.error("OData Create (Update) failed:",e)}})},onBack(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("Routemain")}})});
//# sourceMappingURL=profil.controller.js.map
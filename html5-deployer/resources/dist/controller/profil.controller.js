sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/m/MessageToast"],function(e,t,o){"use strict";return e.extend("rm.webshop.test.controller.profil",{_oInitialUserData:{},onInit:function(){var e=sap.ui.require.toUrl("rm/webshop/test")+"/img/Logo.jpg";var o=new t({rmLogo:e,selectedAddressOption:0,UserInfo:{navn:"",brugernr:"",street:"",zip:"",city:"",tlfnr:"",phone:"",mail:"",DelStreet:"",DelZip:"",DelCity:"",afdeling:""}});this.getView().setModel(o,"view");this.getOwnerComponent().getRouter().getRoute("Routeprofil").attachPatternMatched(this._onRouteMatched,this);this._fetchUserData()},_getCurrentUserNo:function(){const e=this.getOwnerComponent().getModel("globalUser");return e?e.getProperty("/UserNo"):null},_fetchUserData:function(){var e=this.getOwnerComponent().getModel();var t=this.getView().getModel("view");const r=this._getCurrentUserNo();const n=`/UserSet('${r}')`;if(!e){o.show("Error: OData model not available.");return}e.read(n,{urlParameters:{$format:"json"},success:function(e){this._oInitialUserData=e;t.setProperty("/UserInfo",{navn:e.AdrName||"N/A",brugernr:e.UserNo||"N/A",street:e.AdrStreet||"N/A",zip:e.AdrZip||"N/A",city:e.AdrCity||"N/A",tlfnr:e.Phone||"Ukendt, kan opdateres i 'Profil'",phone:e.Phone||"",mail:e.EMail||"",DelStreet:e.DelStreet||"",DelZip:e.DelZip||"",DelCity:e.DelCity||"",afdeling:e.Afdeling})}.bind(this),error:function(e){o.show("Failed to load user data.");console.error("OData Read failed:",e);t.setProperty("/UserInfo",{navn:"Fejl: Kunne ikke hente data",street:"",zip:"",city:"",tlfnr:"",brugernr:"",afdeling:""})}.bind(this)})},_onRouteMatched:function(e){var t=this.byId("idTopLevelTab");if(t){t.setSelectedKey("HeadProfil")}},handleIconTabBarSelect:function(e){var t=e.getParameter("selectedKey");if(t==="HeadSoegning"){this.getOwnerComponent().getRouter().navTo("Routevaresog")}if(t==="HeadOversigt"){this.getOwnerComponent().getRouter().navTo("Routebestilling")}if(t==="HeadProfil"){this.getOwnerComponent().getRouter().navTo("Routeprofil")}if(t==="HeadSupport"){this.getOwnerComponent().getRouter().navTo("Routesupport")}},onUpdateUser:function(){var e=this.getOwnerComponent().getModel();var t=this.getView().getModel("view");var r=t.getProperty("/UserInfo");var n=this._oInitialUserData;const i=this._getCurrentUserNo();if(!e){o.show("Fejl: OData model ikke tilgængelig.");return}var a={UserNo:i,DelName:n.DelName||"DEL Lægerne Gasvej 5",DelName2:n.DelName2||"Del name2",DelAtt:n.DelAtt||"DEL ATT",FavoriteList:n.FavoriteList||"Favorite99",DelStreet:r.DelStreet,DelZip:r.DelZip,DelCity:r.DelCity,Phone:r.phone,EMail:r.mail};e.create("/UserSet",a,{success:function(e,n){o.show("Brugerinformation opdateret succesfuldt!");t.setProperty("/UserInfo/tlfnr",r.phone);this._fetchUserData()}.bind(this),error:function(e){o.show("Fejl ved opdatering af brugerinformation.");console.error("OData Create (Update) failed:",e)}})},onBack:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);var t=this.getView().getModel("view");var o=this._getCurrentUserNo();var r=this.getOwnerComponent().getModel();var n=[new sap.ui.model.Filter("UserNo",sap.ui.model.FilterOperator.EQ,o)];r.read("/BasketSet",{filters:n,success:function(t){var o=t.results||[];if(o.length>0){sap.m.MessageBox.confirm("Du har varer i din kurv. Vil du fortsat logge af? (Din kurv gemmes til næste besøg)",{title:"Bekræft log af",actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(t){if(t===sap.m.MessageBox.Action.OK){e.navTo("Routemain")}}})}else{e.navTo("Routemain")}},error:function(t){sap.m.MessageBox.warning("Kunne ikke hente din kurv. Vil du fortsætte med at logge af?",{actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(t){if(t===sap.m.MessageBox.Action.OK){e.navTo("Routemain")}}});console.error("BasketSet read error during logoff:",t)}})},onOpenBasket:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("Routevaresog")}})});
//# sourceMappingURL=profil.controller.js.map